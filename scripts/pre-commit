#!/bin/bash
# Pre-commit hook to prevent direct commits to protected branches
# This hook blocks commits to main and develop branches

# Colors for output
RED='\033[0;31m'
YELLOW='\033[1;33m'
GREEN='\033[0;32m'
NC='\033[0m' # No Color

# Get the current branch name
branch="$(git rev-parse --abbrev-ref HEAD)"

# List of protected branches (add more if needed)
protected_branches=("main" "master" "develop")

# Check if current branch is protected
for protected in "${protected_branches[@]}"; do
    if [ "$branch" = "$protected" ]; then
        echo ""
        echo -e "${RED}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
        echo -e "${RED}â•‘                    âŒ COMMIT BLOCKED âŒ                        â•‘${NC}"
        echo -e "${RED}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        echo ""
        echo -e "${YELLOW}You are trying to commit directly to the '${branch}' branch.${NC}"
        echo -e "${YELLOW}This is not allowed to prevent accidental commits to protected branches.${NC}"
        echo ""
        echo -e "${GREEN}âœ… Recommended workflow:${NC}"
        echo ""
        echo "  1. Create a feature branch:"
        echo -e "     ${GREEN}git checkout -b feature/your-feature-name${NC}"
        echo ""
        echo "  2. Make your changes and commit:"
        echo -e "     ${GREEN}git add .${NC}"
        echo -e "     ${GREEN}git commit -m \"Your commit message\"${NC}"
        echo ""
        echo "  3. Push your feature branch:"
        echo -e "     ${GREEN}git push origin feature/your-feature-name${NC}"
        echo ""
        echo "  4. Create a Pull Request on GitHub to merge into '${branch}'"
        echo ""
        echo -e "${YELLOW}ğŸ’¡ Common branch naming conventions:${NC}"
        echo "   â€¢ feature/add-new-functionality"
        echo "   â€¢ bugfix/fix-issue-123"
        echo "   â€¢ hotfix/critical-security-patch"
        echo "   â€¢ docs/update-readme"
        echo ""
        echo -e "${YELLOW}âš ï¸  If you absolutely must commit to '${branch}' (not recommended):${NC}"
        echo -e "     ${RED}git commit --no-verify -m \"Your message\"${NC}"
        echo ""
        exit 1
    fi
done

# If we get here, the branch is not protected - allow commit
exit 0

